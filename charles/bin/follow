#!/usr/bin/env python3
import os
import sys

sys.argv.append('.')
path = sys.argv[1]
if path.startswith('-') or path == 'help':
    print('Usage:', __file__, '<videos path>')
    print('Watch videos and record the watching progress. Resume at the progress recorded')
    exit()

schedule_path = os.path.join(path, 'progress')

videos = sorted([i for i in os.listdir(path) if i.split('.')[-1].lower() in ['mp4', 'mkv', 'rmvb']])
if len(videos) == 0:
    print('No video found')
    exit(0)

if not os.path.exists(schedule_path):
    index = 0
else:
    current = open(schedule_path, 'r').readline().strip()
    index = videos.index(current) + 1

for video in videos[index:]:
    video_path = os.path.join(path, video)
    try:
        status = os.system('mpv {}'.format(video_path))
        if status != 0:
            break
        open(schedule_path, 'w').write(video)
    except (KeyboardInterrupt, EOFError):
        break
